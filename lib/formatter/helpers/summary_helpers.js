'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.formatSummary = formatSummary;

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _duration = require('duration');

var _duration2 = _interopRequireDefault(_duration);

var _status = require('../../status');

var _status2 = _interopRequireDefault(_status);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var STATUS_REPORT_ORDER = [_status2.default.FAILED, _status2.default.AMBIGUOUS, _status2.default.UNDEFINED, _status2.default.PENDING, _status2.default.SKIPPED, _status2.default.RETRY, _status2.default.PASSED];

function formatSummary(_ref) {
  var colorFns = _ref.colorFns,
      testCaseMap = _ref.testCaseMap,
      testRun = _ref.testRun;

  var testCaseResults = [];
  var testStepResults = [];
  _lodash2.default.each(testCaseMap, function (_ref2) {
    var result = _ref2.result,
        steps = _ref2.steps;

    testCaseResults.push(result);
    _lodash2.default.each(steps, function (testStep) {
      if (testStep.sourceLocation) {
        testStepResults.push(testStep.result);
      }
    });
  });
  var scenarioSummary = getCountSummary({
    colorFns: colorFns,
    objects: testCaseResults,
    type: 'scenario'
  });
  var stepSummary = getCountSummary({
    colorFns: colorFns,
    objects: testStepResults,
    type: 'step'
  });
  var durationSummary = getDuration(testRun.result.duration);
  return [scenarioSummary, stepSummary, durationSummary].join('\n');
}

function getCountSummary(_ref3) {
  var colorFns = _ref3.colorFns,
      objects = _ref3.objects,
      type = _ref3.type;

  var counts = _lodash2.default.chain(objects).groupBy('status').mapValues('length').value();
  var total = _lodash2.default.reduce(counts, function (memo, value) {
    return memo + value;
  }) || 0;
  var text = total + ' ' + type + (total === 1 ? '' : 's');
  if (total > 0) {
    var details = [];
    STATUS_REPORT_ORDER.forEach(function (status) {
      if (counts[status] > 0) {
        details.push(colorFns[status](counts[status] + ' ' + status));
      }
    });
    text += ' (' + details.join(', ') + ')';
  }
  return text;
}

function getDuration(milliseconds) {
  var start = new Date(0);
  var end = new Date(milliseconds);
  var duration = new _duration2.default(start, end);

  return duration.minutes + 'm' + duration.toString('%S') + '.' + duration.toString('%L') + 's' + '\n';
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9mb3JtYXR0ZXIvaGVscGVycy9zdW1tYXJ5X2hlbHBlcnMuanMiXSwibmFtZXMiOlsiZm9ybWF0U3VtbWFyeSIsIlNUQVRVU19SRVBPUlRfT1JERVIiLCJGQUlMRUQiLCJBTUJJR1VPVVMiLCJVTkRFRklORUQiLCJQRU5ESU5HIiwiU0tJUFBFRCIsIlJFVFJZIiwiUEFTU0VEIiwiY29sb3JGbnMiLCJ0ZXN0Q2FzZU1hcCIsInRlc3RSdW4iLCJ0ZXN0Q2FzZVJlc3VsdHMiLCJ0ZXN0U3RlcFJlc3VsdHMiLCJlYWNoIiwicmVzdWx0Iiwic3RlcHMiLCJwdXNoIiwidGVzdFN0ZXAiLCJzb3VyY2VMb2NhdGlvbiIsInNjZW5hcmlvU3VtbWFyeSIsImdldENvdW50U3VtbWFyeSIsIm9iamVjdHMiLCJ0eXBlIiwic3RlcFN1bW1hcnkiLCJkdXJhdGlvblN1bW1hcnkiLCJnZXREdXJhdGlvbiIsImR1cmF0aW9uIiwiam9pbiIsImNvdW50cyIsImNoYWluIiwiZ3JvdXBCeSIsIm1hcFZhbHVlcyIsInZhbHVlIiwidG90YWwiLCJyZWR1Y2UiLCJtZW1vIiwidGV4dCIsImRldGFpbHMiLCJmb3JFYWNoIiwic3RhdHVzIiwibWlsbGlzZWNvbmRzIiwic3RhcnQiLCJEYXRlIiwiZW5kIiwibWludXRlcyIsInRvU3RyaW5nIl0sIm1hcHBpbmdzIjoiOzs7OztRQWNnQkEsYSxHQUFBQSxhOztBQWRoQjs7OztBQUNBOzs7O0FBQ0E7Ozs7OztBQUVBLElBQU1DLHNCQUFzQixDQUMxQixpQkFBT0MsTUFEbUIsRUFFMUIsaUJBQU9DLFNBRm1CLEVBRzFCLGlCQUFPQyxTQUhtQixFQUkxQixpQkFBT0MsT0FKbUIsRUFLMUIsaUJBQU9DLE9BTG1CLEVBTTFCLGlCQUFPQyxLQU5tQixFQU8xQixpQkFBT0MsTUFQbUIsQ0FBNUI7O0FBVU8sU0FBU1IsYUFBVCxPQUEyRDtBQUFBLE1BQWxDUyxRQUFrQyxRQUFsQ0EsUUFBa0M7QUFBQSxNQUF4QkMsV0FBd0IsUUFBeEJBLFdBQXdCO0FBQUEsTUFBWEMsT0FBVyxRQUFYQSxPQUFXOztBQUNoRSxNQUFNQyxrQkFBa0IsRUFBeEI7QUFDQSxNQUFNQyxrQkFBa0IsRUFBeEI7QUFDQSxtQkFBRUMsSUFBRixDQUFPSixXQUFQLEVBQW9CLGlCQUF1QjtBQUFBLFFBQXBCSyxNQUFvQixTQUFwQkEsTUFBb0I7QUFBQSxRQUFaQyxLQUFZLFNBQVpBLEtBQVk7O0FBQ3pDSixvQkFBZ0JLLElBQWhCLENBQXFCRixNQUFyQjtBQUNBLHFCQUFFRCxJQUFGLENBQU9FLEtBQVAsRUFBYyxvQkFBWTtBQUN4QixVQUFJRSxTQUFTQyxjQUFiLEVBQTZCO0FBQzNCTix3QkFBZ0JJLElBQWhCLENBQXFCQyxTQUFTSCxNQUE5QjtBQUNEO0FBQ0YsS0FKRDtBQUtELEdBUEQ7QUFRQSxNQUFNSyxrQkFBa0JDLGdCQUFnQjtBQUN0Q1osc0JBRHNDO0FBRXRDYSxhQUFTVixlQUY2QjtBQUd0Q1csVUFBTTtBQUhnQyxHQUFoQixDQUF4QjtBQUtBLE1BQU1DLGNBQWNILGdCQUFnQjtBQUNsQ1osc0JBRGtDO0FBRWxDYSxhQUFTVCxlQUZ5QjtBQUdsQ1UsVUFBTTtBQUg0QixHQUFoQixDQUFwQjtBQUtBLE1BQU1FLGtCQUFrQkMsWUFBWWYsUUFBUUksTUFBUixDQUFlWSxRQUEzQixDQUF4QjtBQUNBLFNBQU8sQ0FBQ1AsZUFBRCxFQUFrQkksV0FBbEIsRUFBK0JDLGVBQS9CLEVBQWdERyxJQUFoRCxDQUFxRCxJQUFyRCxDQUFQO0FBQ0Q7O0FBRUQsU0FBU1AsZUFBVCxRQUFzRDtBQUFBLE1BQTNCWixRQUEyQixTQUEzQkEsUUFBMkI7QUFBQSxNQUFqQmEsT0FBaUIsU0FBakJBLE9BQWlCO0FBQUEsTUFBUkMsSUFBUSxTQUFSQSxJQUFROztBQUNwRCxNQUFNTSxTQUFTLGlCQUFFQyxLQUFGLENBQVFSLE9BQVIsRUFDWlMsT0FEWSxDQUNKLFFBREksRUFFWkMsU0FGWSxDQUVGLFFBRkUsRUFHWkMsS0FIWSxFQUFmO0FBSUEsTUFBTUMsUUFBUSxpQkFBRUMsTUFBRixDQUFTTixNQUFULEVBQWlCLFVBQUNPLElBQUQsRUFBT0gsS0FBUDtBQUFBLFdBQWlCRyxPQUFPSCxLQUF4QjtBQUFBLEdBQWpCLEtBQW1ELENBQWpFO0FBQ0EsTUFBSUksT0FBVUgsS0FBVixTQUFtQlgsSUFBbkIsSUFBMEJXLFVBQVUsQ0FBVixHQUFjLEVBQWQsR0FBbUIsR0FBN0MsQ0FBSjtBQUNBLE1BQUlBLFFBQVEsQ0FBWixFQUFlO0FBQ2IsUUFBTUksVUFBVSxFQUFoQjtBQUNBckMsd0JBQW9Cc0MsT0FBcEIsQ0FBNEIsa0JBQVU7QUFDcEMsVUFBSVYsT0FBT1csTUFBUCxJQUFpQixDQUFyQixFQUF3QjtBQUN0QkYsZ0JBQVFyQixJQUFSLENBQWFSLFNBQVMrQixNQUFULEVBQW9CWCxPQUFPVyxNQUFQLENBQXBCLFNBQXNDQSxNQUF0QyxDQUFiO0FBQ0Q7QUFDRixLQUpEO0FBS0FILG1CQUFhQyxRQUFRVixJQUFSLENBQWEsSUFBYixDQUFiO0FBQ0Q7QUFDRCxTQUFPUyxJQUFQO0FBQ0Q7O0FBRUQsU0FBU1gsV0FBVCxDQUFxQmUsWUFBckIsRUFBbUM7QUFDakMsTUFBTUMsUUFBUSxJQUFJQyxJQUFKLENBQVMsQ0FBVCxDQUFkO0FBQ0EsTUFBTUMsTUFBTSxJQUFJRCxJQUFKLENBQVNGLFlBQVQsQ0FBWjtBQUNBLE1BQU1kLFdBQVcsdUJBQWFlLEtBQWIsRUFBb0JFLEdBQXBCLENBQWpCOztBQUVBLFNBQ0tqQixTQUFTa0IsT0FBWixTQUF1QmxCLFNBQVNtQixRQUFULENBQWtCLElBQWxCLENBQXZCLFNBQWtEbkIsU0FBU21CLFFBQVQsQ0FDaEQsSUFEZ0QsQ0FBbEQsYUFERjtBQUtEIiwiZmlsZSI6InN1bW1hcnlfaGVscGVycy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCdcbmltcG9ydCBEdXJhdGlvbiBmcm9tICdkdXJhdGlvbidcbmltcG9ydCBTdGF0dXMgZnJvbSAnLi4vLi4vc3RhdHVzJ1xuXG5jb25zdCBTVEFUVVNfUkVQT1JUX09SREVSID0gW1xuICBTdGF0dXMuRkFJTEVELFxuICBTdGF0dXMuQU1CSUdVT1VTLFxuICBTdGF0dXMuVU5ERUZJTkVELFxuICBTdGF0dXMuUEVORElORyxcbiAgU3RhdHVzLlNLSVBQRUQsXG4gIFN0YXR1cy5SRVRSWSxcbiAgU3RhdHVzLlBBU1NFRCxcbl1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdFN1bW1hcnkoeyBjb2xvckZucywgdGVzdENhc2VNYXAsIHRlc3RSdW4gfSkge1xuICBjb25zdCB0ZXN0Q2FzZVJlc3VsdHMgPSBbXVxuICBjb25zdCB0ZXN0U3RlcFJlc3VsdHMgPSBbXVxuICBfLmVhY2godGVzdENhc2VNYXAsICh7IHJlc3VsdCwgc3RlcHMgfSkgPT4ge1xuICAgIHRlc3RDYXNlUmVzdWx0cy5wdXNoKHJlc3VsdClcbiAgICBfLmVhY2goc3RlcHMsIHRlc3RTdGVwID0+IHtcbiAgICAgIGlmICh0ZXN0U3RlcC5zb3VyY2VMb2NhdGlvbikge1xuICAgICAgICB0ZXN0U3RlcFJlc3VsdHMucHVzaCh0ZXN0U3RlcC5yZXN1bHQpXG4gICAgICB9XG4gICAgfSlcbiAgfSlcbiAgY29uc3Qgc2NlbmFyaW9TdW1tYXJ5ID0gZ2V0Q291bnRTdW1tYXJ5KHtcbiAgICBjb2xvckZucyxcbiAgICBvYmplY3RzOiB0ZXN0Q2FzZVJlc3VsdHMsXG4gICAgdHlwZTogJ3NjZW5hcmlvJyxcbiAgfSlcbiAgY29uc3Qgc3RlcFN1bW1hcnkgPSBnZXRDb3VudFN1bW1hcnkoe1xuICAgIGNvbG9yRm5zLFxuICAgIG9iamVjdHM6IHRlc3RTdGVwUmVzdWx0cyxcbiAgICB0eXBlOiAnc3RlcCcsXG4gIH0pXG4gIGNvbnN0IGR1cmF0aW9uU3VtbWFyeSA9IGdldER1cmF0aW9uKHRlc3RSdW4ucmVzdWx0LmR1cmF0aW9uKVxuICByZXR1cm4gW3NjZW5hcmlvU3VtbWFyeSwgc3RlcFN1bW1hcnksIGR1cmF0aW9uU3VtbWFyeV0uam9pbignXFxuJylcbn1cblxuZnVuY3Rpb24gZ2V0Q291bnRTdW1tYXJ5KHsgY29sb3JGbnMsIG9iamVjdHMsIHR5cGUgfSkge1xuICBjb25zdCBjb3VudHMgPSBfLmNoYWluKG9iamVjdHMpXG4gICAgLmdyb3VwQnkoJ3N0YXR1cycpXG4gICAgLm1hcFZhbHVlcygnbGVuZ3RoJylcbiAgICAudmFsdWUoKVxuICBjb25zdCB0b3RhbCA9IF8ucmVkdWNlKGNvdW50cywgKG1lbW8sIHZhbHVlKSA9PiBtZW1vICsgdmFsdWUpIHx8IDBcbiAgbGV0IHRleHQgPSBgJHt0b3RhbH0gJHt0eXBlfSR7dG90YWwgPT09IDEgPyAnJyA6ICdzJ31gXG4gIGlmICh0b3RhbCA+IDApIHtcbiAgICBjb25zdCBkZXRhaWxzID0gW11cbiAgICBTVEFUVVNfUkVQT1JUX09SREVSLmZvckVhY2goc3RhdHVzID0+IHtcbiAgICAgIGlmIChjb3VudHNbc3RhdHVzXSA+IDApIHtcbiAgICAgICAgZGV0YWlscy5wdXNoKGNvbG9yRm5zW3N0YXR1c10oYCR7Y291bnRzW3N0YXR1c119ICR7c3RhdHVzfWApKVxuICAgICAgfVxuICAgIH0pXG4gICAgdGV4dCArPSBgICgke2RldGFpbHMuam9pbignLCAnKX0pYFxuICB9XG4gIHJldHVybiB0ZXh0XG59XG5cbmZ1bmN0aW9uIGdldER1cmF0aW9uKG1pbGxpc2Vjb25kcykge1xuICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKDApXG4gIGNvbnN0IGVuZCA9IG5ldyBEYXRlKG1pbGxpc2Vjb25kcylcbiAgY29uc3QgZHVyYXRpb24gPSBuZXcgRHVyYXRpb24oc3RhcnQsIGVuZClcblxuICByZXR1cm4gKFxuICAgIGAke2R1cmF0aW9uLm1pbnV0ZXN9bSR7ZHVyYXRpb24udG9TdHJpbmcoJyVTJyl9LiR7ZHVyYXRpb24udG9TdHJpbmcoXG4gICAgICAnJUwnXG4gICAgKX1zYCArIGBcXG5gXG4gIClcbn1cbiJdfQ==